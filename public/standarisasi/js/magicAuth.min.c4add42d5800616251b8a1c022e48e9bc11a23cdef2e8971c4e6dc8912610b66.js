import{auth}from"/js/firebaseConfig.js";import{signInWithEmailAndPassword,GoogleAuthProvider,GithubAuthProvider,signInWithPopup,sendPasswordResetEmail,}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";document.addEventListener("DOMContentLoaded",()=>{class e{constructor(e){this.container=e,this.isModal=this.container.classList.contains("magic-auth-modal-wrapper"),this.modal=this.container.querySelector(".magic-auth-modal"),this.auth=auth,this.initAuth(),this.initEventListeners()}initAuth(){this.isModal&&(this.createOverlay(),this.initModal())}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="magic-auth-modal-overlay",document.body.appendChild(this.overlay)}initModal(){this.triggerButton=this.container.querySelector(".magic-auth-trigger"),this.triggerButton.addEventListener("click",()=>this.show()),this.closeButton=this.modal.querySelector(".magic-auth-close"),this.closeButton.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",()=>this.hide())}initEventListeners(){const e=this.container.querySelector("form");e&&e.addEventListener("submit",e=>{e.preventDefault(),this.handleFormSubmit()});const t=this.container.querySelector(".magic-auth-google-btn");t&&t.addEventListener("click",()=>this.socialLogin(new GoogleAuthProvider));const n=this.container.querySelector(".magic-auth-github-btn");n&&n.addEventListener("click",()=>this.socialLogin(new GithubAuthProvider));const s=this.container.querySelector(".magic-auth-forgot-password");s&&s.addEventListener("click",e=>{e.preventDefault(),this.handleForgotPassword()})}async handleFormSubmit(){const e=this.container.querySelector("#magic-auth-email").value,t=this.container.querySelector("#magic-auth-password").value;try{await signInWithEmailAndPassword(this.auth,e,t)}catch(e){this.showError(this.parseAuthError(e.code))}}async socialLogin(e){try{await signInWithPopup(this.auth,e)}catch(e){this.showError(this.parseAuthError(e.code))}}async handleForgotPassword(){const e=prompt("Masukkan email Anda:");if(e)try{await sendPasswordResetEmail(this.auth,e),alert("Email reset password telah dikirim!")}catch(e){this.showError(this.parseAuthError(e.code))}}parseAuthError(e){const t={"auth/invalid-email":"Email tidak valid","auth/user-disabled":"Akun dinonaktifkan","auth/user-not-found":"Akun tidak ditemukan","auth/wrong-password":"Password salah","auth/popup-closed-by-user":"Popup login ditutup","auth/cancelled-popup-request":"Login dibatalkan","auth/account-exists-with-different-credential":"Akun sudah ada dengan metode login berbeda"};return t[e]||"Terjadi kesalahan, silakan coba lagi"}showError(e){const t=this.container.querySelector(".magic-auth-error");t.textContent=e,t.style.display="block",setTimeout(()=>t.style.display="none",5e3)}show(){this.isModal&&(this.modal.style.display="block",this.overlay.style.display="block",document.body.style.overflow="hidden")}hide(){this.isModal&&(this.modal.style.display="none",this.overlay.style.display="none",document.body.style.overflow="auto")}}document.querySelectorAll(".magic-auth").forEach(t=>{new e(t)})})