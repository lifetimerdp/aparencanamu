import{db,auth,analytics,doc,setDoc,getDoc,updateDoc,increment,logEvent}from"/js/firebaseConfig.js";document.addEventListener("DOMContentLoaded",()=>{initializeMagicCards()});async function initializeMagicCards(){document.querySelectorAll(".magic-like-btn").forEach(e=>{e.addEventListener("click",handleLike)}),document.querySelectorAll(".magic-action-btn").forEach(e=>{e.addEventListener("click",trackAction)});const e=document.querySelectorAll(".magic-card[data-dokumen]");e.forEach(async e=>{const t=e.dataset.dokumen;await initMagicDocument(t);const n=await getLikesCount(t);e.querySelector(".magic-like-count").textContent=n})}async function initMagicDocument(e){const t=doc(db,"magicKomponen",e),n=await getDoc(t);n.exists()||await setDoc(t,{likes:0,createdAt:new Date})}async function handleLike(e){const t=e.target.closest(".magic-card"),n=t.dataset.dokumen,s=auth.currentUser;if(!s){alert("Silakan login untuk memberikan like!");return}try{const e=doc(db,"magicKomponen",n),s=await getDoc(e),o=s.exists()?s.data().likes||0:0;await updateDoc(e,{likes:o+1});const i=t.querySelector(".magic-like-count");i.textContent=o+1}catch(e){console.error("Error updating like:",e)}}async function getLikesCount(e){try{const n=doc(db,"magicKomponen",e),t=await getDoc(n);return t.exists()?t.data().likes||0:0}catch(e){return console.error("Error getting likes:",e),0}}function trackAction(e){const t=e.target.dataset.action,n=e.target.textContent.trim();logEvent(analytics,"card_action",{action:t,button_text:n})}