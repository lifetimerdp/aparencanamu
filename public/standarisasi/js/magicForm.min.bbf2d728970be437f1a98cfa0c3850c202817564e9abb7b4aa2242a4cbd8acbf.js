import{auth,db,doc,setDoc,updateDoc,getDoc}from"/js/firebaseConfig.js";document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".magic-form");e.forEach(e=>{const n=e.closest(".magic-form-container"),o=n.dataset.koleksi,i=n.dataset.dokumen,s=n.dataset.redirect,t=n.querySelector(".status-message");e.addEventListener("submit",async n=>{n.preventDefault();try{const n=auth.currentUser;if(!n)throw new Error("Pengguna belum login");const c=i||n.uid,a=doc(db,o,c),r=Object.fromEntries(new FormData(e)),l=await getDoc(a);l.exists()?await updateDoc(a,r):await setDoc(a,{...r,createdAt:new Date,userId:n.uid}),t.textContent="Data berhasil disimpan!",t.classList.add("success"),s&&setTimeout(()=>{window.location.href=s},1500)}catch(e){console.error("Error:",e),t.textContent=`Gagal menyimpan: ${e.message}`,t.classList.add("error")}finally{t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3)}})})})